<!DOCTYPE html>
<html>
<head>
    <title>JavaScript Client</title>
</head>
<body>
    <h1>JavaScript Client</h1>
    <label id="label"></label>
    <input id="input" value="Name"/>
</body>
<script>
    const connection = new WebSocket('ws://127.0.0.1:55501');
    let command = "IDLE"

    document.onkeypress = function (e) {
        if (e.keyCode === 119) command = "MOVE_UP"
        if (e.keyCode === 115) command = "MOVE_DOWN"
        if (e.keyCode === 97)  command = "MOVE_LEFT"
        if (e.keyCode === 100) command = "MOVE_RIGHT"
    };

    document.onkeydown = function (e) {
        console.log(e.keyCode)
        if (e.keyCode === 38) command = "ROTATE_UP"
        if (e.keyCode === 40) command = "ROTATE_DOWN"
        if (e.keyCode === 37)  command = "ROTATE_LEFT"
        if (e.keyCode === 39) command = "ROTATE_RIGHT"
    }

    connection.onmessage = function(event) {
        // Parse game state
        const gameState = JSON.parse(event.data);
        document.getElementById("label").innerHTML = gameState.timestamp;

        // Create and sent response
        const clientResponse = JSON.stringify({
            clientName: document.getElementById("input").value,
            command: command
        });
        connection.send(clientResponse);

        // Reset command
        command = "IDLE"
    }
</script>
</html>

